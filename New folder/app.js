let menu = [
  {
    name: "shahi paneer",
    id: "1",
    price: 200,
  },
  {
    name: "kadahi paneer",
    id: "2",
    price: 200,
  },
  {
    name: "Dal makhni",
    id: "3",
    price: 130,
  },
  {
    name: "saag",
    id: "4",
    price: 120,
  },
  {
    name: "dal fry",
    id: "5",
    price: 100,
  },
  {
    name: "yellow dal",
    id: "6",
    price: 130,
  },
  {
    name: "channa masala",
    id: "7",
    price: 180,
  },
  {
    name: "mutter paneer",
    id: "8",
    price: 180,
  },
  {
    name: "paneer butter masala",
    id: "9",
    price: 200,
  },
  {
    name: "paneer bhurji",
    id: "10",
    price: 200,
  },
  {
    name: "palak paneer",
    id: "11",
    price: 180,
  },
  {
    name: "malai kofta",
    id: "12",
    price: 200,
  },
  {
    name: "mushroom mutter",
    id: "13",
    price: 200,
  },
  {
    name: "mushroom masala",
    id: "14",
    price: 200,
  },
  {
    name: "alloo mutter",
    id: "15",
    price: 120,
  },
  {
    name: "allo zeera",
    id: "16",
    price: 120,
  },
  {
    name: "rajmah",
    id: "17",
    price: 140,
  },
  {
    name: "mix veg",
    id: "18",
    price: 180,
  },
  {
    name: "allo gobi",
    id: "19",
    price: 150,
  },
  {
    name: "cheese tomato",
    id: "20",
    price: 200,
  },
  ///////////////////////////////////////////////////////////////////////
  {
    name: "milk tea",
    id: "21",
    price: 15,
  },
  {
    name: "coffee",
    id: "22",
    price: 30,
  },
  {
    name: "milk patti",
    id: "23",
    price: 30,
  },
  {
    name: "milk",
    id: "24",
    price: 25,
  },

  {
    name: "sweet lassi",
    id: "25",
    price: 40,
  },

  ///////////////////////////////////////////////////////////////////////
  {
    name: "plain parantha",
    id: "26",
    price: 25,
  },
  {
    name: "allo parantha",
    id: "27",
    price: 40,
  },
  {
    name: "gobi parantha",
    id: "28",
    price: 40,
  },
  {
    name: "mix parantha",
    id: "29",
    price: 50,
  },
  {
    name: "paneer parantha",
    id: "30",
    price: 70,
  },

  ///////////////////////////////////////////////////////////////////////
  {
    name: "plain salad",
    id: "31",
    price: 30,
  },
  {
    name: "green salad",
    id: "32",
    price: 40,
  },
  {
    name: "dahi",
    id: "33",
    price: 70,
  },
  {
    name: "mix raita",
    id: "34",
    price: 90,
  },
  {
    name: "bundi raita",
    id: "35",
    price: 80,
  },
  {
    name: "cream salad",
    id: "36",
    price: 100,
  },
  {
    name: "cheese chilly",
    id: "37",
    price: 250,
  },
  {
    name: "paneer tikka",
    id: "38",
    price: 250,
  },
  {
    name: "finger chips",
    id: "39",
    price: 100,
  },
  {
    name: "penunt masala",
    id: "40",
    price: 70,
  },
  {
    name: "mix pakoda",
    id: "41",
    price: 120,
  },
  {
    name: "gobi pakoda",
    id: "42",
    price: 100,
  },
  {
    name: "paneer pakoda",
    id: "43",
    price: 150,
  },
  {
    name: "mushroom chilly",
    id: "44",
    price: 250,
  },
  {
    name: "manchurian",
    id: "45",
    price: 150,
  },
  {
    name: "egg omelette (2 egg)",
    id: "46",
    price: 40,
  },
  {
    name: "egg bhurji (2 egg)",
    id: "47",
    price: 40,
  },
  {
    name: "chicken tikka",
    id: "48",
    price: 450,
  },
  {
    name: "fish tikka",
    id: "49",
    price: 350,
  },
  {
    name: "plain thali ",
    id: "50",
    price: 100,
  },
  {
    name: "special thali ",
    id: "51",
    price: 180,
  },

  ///////////////////////////////////////////////////////////////////////
  {
    name: "butter chicken",
    id: "52",
    price: 500,
  },
  {
    name: "kadhai chicken",
    id: "53",
    price: 500,
  },
  {
    name: "afghani chicken",
    id: "54",
    price: 500,
  },
  {
    name: "chicken fry",
    id: "55",
    price: 500,
  },
  {
    name: "half butter chicken",
    id: "56",
    price: 280,
  },
  {
    name: "half kadhai chicken",
    id: "57",
    price: 280,
  },
  {
    name: "half afghani chicken",
    id: "58",
    price: 280,
  },
  {
    name: "half chicken fry",
    id: "59",
    price: 280,
  },
  {
    name: "mutton",
    id: "60",
    price: 550,
  },
  {
    name: "half mutton",
    id: "61",
    price: 300,
  },
  {
    name: "chicken pakoda",
    id: "62",
    price: 500,
  },
  {
    name: "half chicken pakoda",
    id: "63",
    price: 280,
  },
  {
    name: "boneless chicken",
    id: "64",
    price: 550,
  },
  {
    name: "half boneless chicken",
    id: "65",
    price: 300,
  },
  {
    name: "fish plate (8 pc)",
    id: "66",
    price: 350,
  },
  {
    name: "chilly chicken",
    id: "67",
    price: 500,
  },
  {
    name: "half chilly chicken",
    id: "68",
    price: 280,
  },
  {
    name: "masla chicken",
    id: "69",
    price: 500,
  },
  {
    name: "half masla chicken",
    id: "70",
    price: 280,
  },
  {
    name: "chicken biryani",
    id: "71",
    price: 280,
  },
  {
    name: "tandoori chicken",
    id: "72",
    price: 500,
  },
  {
    name: "half tandoori chicken",
    id: "73",
    price: 280,
  },
  {
    name: "garlic chicken",
    id: "74",
    price: 520,
  },
  {
    name: "half garlic chicken",
    id: "75",
    price: 300,
  },
  {
    name: "lemon chicken",
    id: "76",
    price: 520,
  },
  {
    name: "half lemon chicken",
    id: "77",
    price: 320,
  },
  ///////////////////////////////////////////////////////////////////////
  {
    name: "butter roti",
    id: "78",
    price: 12,
  },
  {
    name: "laccha paratha",
    id: "79",
    price: 30,
  },
  {
    name: "plain naan",
    id: "80",
    price: 30,
  },
  {
    name: "butter naan",
    id: "81",
    price: 40,
  },
  {
    name: "makki di roti",
    id: "82",
    price: 20,
  },
  {
    name: "missi roti",
    id: "83",
    price: 25,
  },
  {
    name: "garlic naan",
    id: "84",
    price: 50,
  },
  {
    name: "plain rice",
    id: "85",
    price: 70,
  },
  ///////////////////////////////////////////////////////////////////////
  {
    name: "zeera rice",
    id: "86",
    price: 100,
  },
  {
    name: "veg fried rice",
    id: "87",
    price: 140,
  },
  {
    name: "paneer fried rice",
    id: "88",
    price: 170,
  },
  {
    name: "veg biryani",
    id: "89",
    price: 160,
  },
];

let waiters = [
  {
    name: "waiter 1",
    id: "1",
  },
  {
    name: "waiter 2",
    id: "2",
  },
  {
    name: "waiter 3",
    id: "3",
  },
  {
    name: "waiter 4",
    id: "4",
  },
  {
    name: "waiter 5",
    id: "5",
  },
  {
    name: "waiter 6",
    id: "6",
  },
];

let categories = [
  "veggies",
  "beverages",
  "parantha",
  "sides",
  "chicken",
  "Roti",
  "Rice",
];

let tables = {};

let paidBills = [];

let KOT = [];

let allTotals = [];

let numberoftables = 0;

let addTableBtn = document.getElementById("addtable");

let total = 0;

let selectedTable = null; // Variable to store the selected table

// Select the right-container div
const rightContainer = document.querySelector(".right-container");
const payContainer = document.querySelector(".pay-container");
const billContainer = document.querySelector(".bill-container");
const billContainer2 = document.querySelector(".bill-container2");
const modal = document.getElementById("largeModal");
const closeButton = document.querySelector(".modal-header .close");
const Modal2Content = document.getElementById("editOrder");

closeButton.addEventListener("click", closeModal);

function showModal() {
  const modal = document.getElementById("largeModal");
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
}

function closeModal() {
  const modal = document.getElementById("largeModal");
  const modalInstance = bootstrap.Modal.getInstance(modal);
  modalInstance.hide();
}

function showModal2() {
  const modal = document.getElementById("Modal2");
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
}

function closeModal2() {
  const modal = document.getElementById("Modal2");
  const modalInstance = bootstrap.Modal.getInstance(modal);
  modalInstance.hide();
}

function showModal3() {
  const modal = document.getElementById("Modal3");
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
}

function closeModal3() {
  const modal = document.getElementById("Modal3");
  const modalInstance = bootstrap.Modal.getInstance(modal);
  modalInstance.hide();
}

function showModal4() {
  const modal = document.getElementById("Modal4");
  const modalInstance = new bootstrap.Modal(modal);
  modalInstance.show();
}

function closeModal4() {
  const modal = document.getElementById("Modal4");
  const modalInstance = bootstrap.Modal.getInstance(modal);
  modalInstance.hide();
}

function retrieveTablesFromLocalStorage() {
  let storedTables = JSON.parse(localStorage.getItem("tables"));

  if (storedTables) {
    for (let key in storedTables) {
      if (storedTables.hasOwnProperty(key)) {
        let table = storedTables[key];

        let inputValue = table.tableId;

        let div = document.createElement("div");
        let div2 = document.createElement("div");

        numberoftables++;

        div.classList.add("btn", "btn-outline-secondary", "tablebtn");
        div.setAttribute("id", `table${inputValue}`);
        div.setAttribute("onClick", `generateBill('table${inputValue}')`);
        div2.classList.add("menu");

        div.innerText = "Table " + inputValue + "\n" + table.waiter;

        div2.appendChild(div);
        document.querySelector(".row").appendChild(div2);

        // Add a new key-value pair to the tables object
        tables[`table${inputValue}`] = {
          tableId: inputValue,
          order: table.order,
          finalorder: table.finalorder,
          total: table.total,
          waiter: table.waiter,
        };
      }
    }

    // Update paidBills and allTotals arrays from local storage
    let storedPaidBills = JSON.parse(localStorage.getItem("paidBills"));
    let storedAllTotals = JSON.parse(localStorage.getItem("allTotals"));

    if (storedPaidBills) {
      paidBills = storedPaidBills;
    }

    if (storedAllTotals) {
      allTotals = storedAllTotals;
    }

    // console.log("All tables below");
    // console.log(tables);

    // console.log("All paid bills below");
    // console.log(paidBills);

    return tables;
  } else {
    return {};
  }
}

retrieveTablesFromLocalStorage();

function deleteAllData() {
  let askUser = prompt("type DELETE for deleting all data");

  if (askUser == "delete") {
    // Clear the variables
    tables = {};
    paidBills = [];
    allTotals = [];
    numberoftables = 0;

    // Clear the local storage
    localStorage.removeItem("tables");
    localStorage.removeItem("paidBills");
    localStorage.removeItem("allTotals");

    // Remove all table elements from the DOM
    const tableElements = document.querySelectorAll(".tablebtn");
    tableElements.forEach((element) => {
      element.parentNode.remove();
    });

    // Reset the selectedTable variable
    selectedTable = null;

    alert("Data deleted successfully !!");
  } else {
  }
}

addTableBtn.addEventListener("click", function () {
  const inputElement = document.getElementById("inputTable");
  const inputValue = inputElement.value;

  // Check if the table already exists
  if (tables[`table${inputValue}`] || inputValue <= 0) {
    alert(`Table ${inputValue} cannot be added`);
    return;
  }

  ///////////////////  waiter selection ////////////////////////

  let waiter = "#";

  /////////////////////////////////////////////////////////////////

  let div = document.createElement("div");
  let div2 = document.createElement("div");

  numberoftables++;

  div.classList.add("btn", "btn-outline-secondary");
  div.setAttribute("id", `table${inputValue}`);
  div.setAttribute("onClick", `generateBill('table${inputValue}')`);
  div2.classList.add("menu");

  div.innerText = "Table " + inputValue + "\n" + waiter;

  div2.appendChild(div);
  document.querySelector(".row").appendChild(div2);

  // Add a new key-value pair to the tables object
  tables[`table${inputValue}`] = {
    tableId: inputValue,
    order: [],
    finalorder: [],
    total: 0,
    waiter: waiter,
  };
  localStorage.setItem("tables", JSON.stringify(tables));
  showModal3();
  selectedTable = `table${inputValue}`;
});

function createWaiters() {
  // Get the element where waiters will be appended
  const waiterContainer = document.getElementById("Modal3Content");

  // Clear any existing content in the container
  waiterContainer.innerHTML = "";

  // Loop through the waiters array
  for (let waiter of waiters) {
    // Create a new div element for each waiter
    const div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "waiters");

    div.setAttribute("id", waiter.id);

    div.addEventListener("click", function () {
      selectWaiter(waiter);
    });

    // Set the content or styling for the waiter div
    div.textContent = waiter.name; // Replace with the appropriate waiter property

    // Append the waiter div to the waiter container
    waiterContainer.appendChild(div);
  }
}
createWaiters();

function selectWaiter(waiter) {
  tables[selectedTable].waiter = waiter.name;
  document.getElementById(selectedTable).innerText =
    "Table " + tables[selectedTable].tableId + "\n" + waiter.name;
  closeModal3();
  generateBill(selectedTable);
}

function createMenu() {
  ////////////// categories
  for (let i = 0; i < categories.length; i++) {
    const item = categories[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-primary", "categories");

    div.setAttribute("id", categories[i]);

    div.innerText = categories[i];

    div.addEventListener("click", function () {
      showMenu(item);
    });

    document.querySelector(".mid-container").appendChild(div);
  }
}
createMenu();

function showMenu(category) {
  const smallMidContainer = document.querySelector(".small-mid-container");
  smallMidContainer.innerHTML = "";
  if (category == "veggies") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    veggies();
  }

  if (category == "beverages") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    beverages();
  }

  if (category == "parantha") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    parantha();
  }

  if (category == "sides") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    sides();
  }

  if (category == "chicken") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    chicken();
  }

  if (category == "Roti") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    Roti();
  }

  if (category == "Rice") {
    smallMidContainer.innerHTML = `<div>${category}: </div>`;
    Rice();
  }
}

///////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////
function veggies() {
  ///////////////////////////////////// loop 1

  for (let i = 0; i < 20; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function beverages() {
  /////////////////// loop 2

  for (let i = 20; i < 25; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function parantha() {
  ////////////// loop 3
  for (let i = 25; i < 30; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function sides() {
  /////////// loop 4
  for (let i = 30; i < 51; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function chicken() {
  /////////// loop 5
  for (let i = 51; i < 77; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function Roti() {
  /////////// loop 6
  for (let i = 77; i < 85; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-warning", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addRoti(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

function Rice() {
  /////////// loop 7
  for (let i = 85; i < 89; i++) {
    const item = menu[i];

    let div = document.createElement("div");
    div.classList.add("btn", "btn-danger", "menuitems");

    div.setAttribute("id", item.id);

    div.innerText = item.name;

    div.addEventListener("click", function () {
      addToBill(item);
    });

    document.querySelector(".small-mid-container").appendChild(div);
  }
}

///////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////
function addRoti(item) {
  let count = Number(prompt("Please enter quantity: "));

  // Create a copy of the item
  const itemCopy = { ...item };
  itemCopy.count = count; // Add the count property
  itemCopy.price = count * itemCopy.price;

  const itemInfoDiv = document.createElement("div");
  itemInfoDiv.setAttribute("id", `bill${itemCopy.id}`);
  itemInfoDiv.setAttribute("class", "billing");
  itemInfoDiv.innerText = count + " " + itemCopy.name + " - $" + itemCopy.price;
  billContainer.appendChild(itemInfoDiv);

  // Add the item copy to the order for the selected table
  if (selectedTable) {
    tables[selectedTable].order.push(itemCopy);
    tables[selectedTable].total += itemCopy.price;
  }

  total += itemCopy.price;

  // Add a click event listener to the item in the bill container
  itemInfoDiv.addEventListener("click", function () {
    deleteItem(itemInfoDiv.id);
  });

  console.log(itemCopy);
}

function addToBill(item) {
  const itemInfoDiv = document.createElement("div");
  itemInfoDiv.setAttribute("id", `bill${item.id}`);
  itemInfoDiv.setAttribute("class", "billing");
  itemInfoDiv.innerText = item.name + " - $" + item.price;
  billContainer.appendChild(itemInfoDiv);

  // Add the item to the order for the selected table
  if (selectedTable) {
    tables[selectedTable].order.push(item);
    tables[selectedTable].total += item.price;
  }

  total += item.price;

  // Add a click event listener to the item in the bill container
  itemInfoDiv.addEventListener("click", function () {
    deleteItem(itemInfoDiv.id);
  });
}

function deleteItem(itemId) {
  // Remove the item from the bill container
  const itemElement = document.getElementById(itemId);
  itemElement.remove();
  let newitemelementID = itemId.replace("bill", "");

  for (let i = 0; i < tables[selectedTable].order.length; i++) {
    let item = tables[selectedTable].order[i].id;
    if (item == newitemelementID) {
      // Subtract the price of the deleted item from the total
      tables[selectedTable].total -= tables[selectedTable].order[i].price;

      // Remove the item from the order array
      tables[selectedTable].order.splice(i, 1);
      break;
    }
  }
}

function deleteItem2(itemId) {
  // Remove the item from the bill container
  const itemElement = document.getElementById(itemId);
  itemElement.remove();
  let newitemelementID = itemId.replace("bill", "");

  for (let i = 0; i < tables[selectedTable].finalorder.length; i++) {
    let item = tables[selectedTable].finalorder[i].id;
    if (item == newitemelementID) {
      // Subtract the price of the deleted item from the total
      tables[selectedTable].total -= tables[selectedTable].finalorder[i].price;

      // Remove the item from the order array
      tables[selectedTable].finalorder.splice(i, 1);

      break;
    }
  }
}

function clearbill() {
  // Remove all child elements from the bill container
  while (billContainer.firstChild) {
    billContainer.removeChild(billContainer.firstChild);
  }
  // Save the data to local storage
  localStorage.setItem("tables", JSON.stringify(tables));

  // Save the total amount of the bill and the items to an array/object
  const activeTable = selectedTable;

  closeModal();
  // Reset the total to 0
}

function deleteTable() {
  const activeTable = selectedTable;

  let ask = prompt("type DELETE for deleting the table");

  if (ask == "delete") {
    // Remove the table from the tables object
    delete tables[activeTable];

    selectedTable = null; // Reset the selectedTable variable

    // Remove the table from the DOM
    const tableElement = document.getElementById(activeTable);
    if (tableElement) {
      tableElement.parentNode.remove();
    }

    localStorage.setItem("tables", JSON.stringify(tables));
    closeModal();
  } else {
    alert("Table cannot be deleted !");
  }
}

function paidButton() {
  closeModal();
  showModal4();
  createCashInput();
}

function createCashInput() {
  // Get the modal content element
  const modalContent = document.getElementById("Modal4Content");

  // Clear the existing content
  modalContent.innerHTML = "";

  // Create the cash input section
  const cashInputSection = document.createElement("div");
  cashInputSection.classList.add("cash2");
  cashInputSection.setAttribute("id", "cash2");

  // Create the input group
  const inputGroup = document.createElement("div");
  inputGroup.classList.add("input-group", "input-group-lg");

  // Create the input group prepend element
  const inputGroupPrepend = document.createElement("div");
  inputGroupPrepend.classList.add("input-group-prepend");

  // Create the cash input element
  const cashInput = document.createElement("input");
  cashInput.id = "cashinput";
  cashInput.type = "number";
  cashInput.classList.add("form-control");
  cashInput.setAttribute("aria-label", "Large");
  cashInput.setAttribute("aria-describedby", "inputGroup-sizing-sm");

  // Create the cash input button
  const cashInputBtn = document.createElement("button");
  cashInputBtn.classList.add("btn", "btn-success");
  cashInputBtn.id = "cashinputbtn";
  cashInputBtn.style.width = "200px";
  cashInputBtn.textContent = "DONE";
  cashInputBtn.addEventListener("click", cashdone);

  // Append the input and button to the input group
  inputGroup.appendChild(inputGroupPrepend);
  inputGroup.appendChild(cashInput);
  inputGroup.appendChild(cashInputBtn);

  // Append the input group to the cash input section
  cashInputSection.appendChild(inputGroup);

  // Create the cash buttons
  const cashValues = [100, 200, 300, 400, 500, 1000, 1500, 2000];
  for (let value of cashValues) {
    const cashButton = document.createElement("div");
    cashButton.classList.add("btn", "btn-primary", "cash");
    cashButton.textContent = value;
    cashButton.addEventListener("click", function () {
      cashInput.value = value;
    });
    cashInputSection.appendChild(cashButton);
  }

  // Create the skip button element
  const skipButton = document.createElement("div");
  skipButton.classList.add("btn", "btn-warning", "cash");
  skipButton.textContent = "Skip";
  skipButton.addEventListener("click", skipcash);
  cashInputSection.appendChild(skipButton);
  // Append the cash input section to the modal content
  modalContent.appendChild(cashInputSection);
}

function skipcash() {
  clearbill2();
  closeModal4();
}

function cashdone() {
  let cash = Number(document.getElementById("cashinput").value);

  if (cash >= tables[selectedTable].total) {
    const modalContent = document.getElementById("Modal4Content");
    modalContent.innerHTML = "";

    // Create the "Cash accepted" div
    const cashAcceptedDiv = document.createElement("div");
    cashAcceptedDiv.classList.add("btn", "btn-warning", "sukh");
    cashAcceptedDiv.textContent = "Cash accepted: " + cash;

    // Create the "Bill" div
    const billDiv = document.createElement("div");
    billDiv.classList.add("btn", "btn-danger", "sukh");
    billDiv.textContent = "Bill: " + tables[selectedTable].total;

    // Create the "Change due" div
    const changeDueDiv = document.createElement("div");
    changeDueDiv.classList.add("btn", "btn-success", "sukh");
    const change = cash - tables[selectedTable].total;
    changeDueDiv.textContent = "Change due: " + change;

    // Append the divs to the modal content
    modalContent.appendChild(cashAcceptedDiv);
    modalContent.appendChild(billDiv);
    modalContent.appendChild(changeDueDiv);

    clearbill2();
  } else {
    const div = document.createElement("div");
    div.classList.add("btn", "btn-warning");
    div.textContent = "insufficient cash !";

    document.getElementById("Modal4Content").prepend(div);
  }

  closeModal4AfterDelay();
}

function closeModal4AfterDelay() {
  setTimeout(closeModal4, 5000); // Close modal after 5 seconds (5000 milliseconds)
}

function clearbill2() {
  const activeTable = selectedTable;
  const tableNumber = activeTable.replace("table", "");
  const itemsToMove = tables[activeTable].order.splice(0);
  tables[activeTable].finalorder.push(...itemsToMove);

  const paidBill = {
    tableId: tableNumber,
    totalAmount: tables[activeTable].total,
    items: [...tables[activeTable].finalorder],
  };
  paidBills.push(paidBill);
  allTotals.push(tables[activeTable].total);
  total = 0;

  // Remove the table from the tables object
  delete tables[activeTable];

  selectedTable = null; // Reset the selectedTable variable

  // Remove the table from the DOM
  const tableElement = document.getElementById(activeTable);
  if (tableElement) {
    tableElement.parentNode.remove();
  }

  // Save the data to local storage
  localStorage.setItem("tables", JSON.stringify(tables));
  localStorage.setItem("paidBills", JSON.stringify(paidBills));
  localStorage.setItem("allTotals", JSON.stringify(allTotals));

  closeModal();
}

function printAllBills() {
  for (let i = 0; i < paidBills.length; i++) {
    const paidBill = paidBills[i];
    const receiptContent = generateReceiptContent(paidBill);

    // Open a new window and write the receipt content to it
    let printWindow = window.open("", "Print", "height=600,width=800");
    printWindow.document.write(receiptContent);
  }
  // Print the receipt
  printWindow.print();
  printWindow.close();
}

function Printpaidbill() {
  let tableId = Number(prompt("Enter table ID: "));

  for (let i = 0; i < paidBills.length; i++) {
    let sukh = paidBills[i].tableId;
    if (sukh == tableId) {
      paidBill = paidBills[i];
    }
  }

  if (paidBill) {
    const receiptContent = generateReceiptContent(paidBill);

    // Open a new window and write the receipt content to it
    let printWindow = window.open("", "Print", "height=600,width=800");
    printWindow.document.write(receiptContent);

    // Print the receipt
    printWindow.print();
    printWindow.close();
  } else {
    alert(`Table ${tableId} does not have a paid bill.`);
  }
}

function generateReceiptContent(paidBill) {
  const tableNumber = paidBill.tableId;
  let receiptContent = "<h1>Babe da dhaba - Table " + tableNumber + "</h1>";
  receiptContent += "<ul>";

  // Loop through the items in the paidBill and add them to the receipt content
  for (let i = 0; i < paidBill.items.length; i++) {
    const item = paidBill.items[i];
    receiptContent += "<li>" + item.name + " - $" + item.price + "</li>";
  }

  receiptContent += "</ul>";

  // Add the total amount to the receipt content
  receiptContent += "<h2>Total: $" + paidBill.totalAmount + "</h2>";

  return receiptContent;
}

function showOrder() {
  while (Modal2Content.firstElementChild) {
    Modal2Content.firstElementChild.remove();
  }
  Modal2Content.innerText =
    "Table " +
    tables[selectedTable].tableId +
    " " +
    tables[selectedTable].waiter;

  /////////////////////////// /////////////////////
  order = tables[selectedTable].finalorder;

  for (let i = 0; i < order.length; i++) {
    const itemInfoDiv = document.createElement("div");
    itemInfoDiv.setAttribute("id", `bill${order[i].id}`);
    itemInfoDiv.setAttribute("class", "billing");
    // Add a click event listener to the item in the bill container
    itemInfoDiv.addEventListener("click", function () {
      deleteItem2(itemInfoDiv.id);
    });

    if (order[i].count) {
      itemInfoDiv.innerText +=
        order[i].count + " " + order[i].name + " - $" + order[i].price;
    } else {
      itemInfoDiv.innerText += order[i].name + " - $" + order[i].price;
    }
    Modal2Content.appendChild(itemInfoDiv);
  }
  closeModal();
  showModal2();
}

function generateBill(tableId) {
  selectedTable = tableId;

  showModal();

  if (tables[selectedTable].waiter == "#") {
    showModal3();
  }

  document.querySelector(".modal-title").innerHTML =
    "Table " +
    tables[selectedTable].tableId +
    " " +
    tables[selectedTable].waiter;

  ////////////////////////////////     BILL CONTAINER -  1

  let order = tables[tableId].order;
  billContainer.innerHTML = "KOT: ";

  for (let i = 0; i < order.length; i++) {
    const itemInfoDiv = document.createElement("div");
    itemInfoDiv.setAttribute("id", `bill${order[i].id}`);
    itemInfoDiv.setAttribute("class", "billing");
    // Add a click event listener to the item in the bill container
    itemInfoDiv.addEventListener("click", function () {
      deleteItem(itemInfoDiv.id);
    });

    if (order[i].count) {
      itemInfoDiv.innerText +=
        order[i].count + " " + order[i].name + " - $" + order[i].price;
    } else {
      itemInfoDiv.innerText += order[i].name + " - $" + order[i].price;
    }

    billContainer.appendChild(itemInfoDiv);
  }

  ////////////////////////////////     BILL CONTAINER -  2
  order = tables[tableId].finalorder;
  total = 0;
  billContainer2.innerHTML = "BILL: ";

  for (let i = 0; i < order.length; i++) {
    const itemInfoDiv = document.createElement("div");
    // itemInfoDiv.setAttribute("id", `bill${order[i].id}`);
    itemInfoDiv.setAttribute("class", "billing2");

    if (order[i].count) {
      itemInfoDiv.innerText +=
        order[i].count + " " + order[i].name + " - $" + order[i].price;
    } else {
      itemInfoDiv.innerText += order[i].name + " - $" + order[i].price;
    }
    billContainer2.appendChild(itemInfoDiv);
    total += order[i].price;
  }

  document.getElementById(
    "total"
  ).innerText = `total = ${tables[tableId].total}`;
}

function printKOT() {
  const activeTable = selectedTable;
  const tableNumber = activeTable.replace("table", "");
  let receiptContent =
    "<h1>Babe da dhaba - Table " +
    tableNumber +
    "   By " +
    tables[selectedTable].waiter +
    "</h1>";

  receiptContent += "<ul>";

  // Loop through the items in the bill container and add them to the receipt content

  for (let i = 0; i < tables[selectedTable].order.length; i++) {
    if (tables[selectedTable].order[i].count) {
      receiptContent +=
        "<li>" +
        tables[selectedTable].order[i].count +
        " " +
        tables[selectedTable].order[i].name +
        " - $" +
        tables[selectedTable].order[i].price +
        "</li>";
    } else {
      receiptContent +=
        "<li>" +
        tables[selectedTable].order[i].name +
        " - $" +
        tables[selectedTable].order[i].price +
        "</li>";
    }
  }

  receiptContent += "</ul>";

  // receiptContent += "<h2>KOT AMOUNT: $" + tables[selectedTable].total + "</h2>";

  // Open a new window and write the receipt content to it
  let printWindow = window.open("", "Print", "height=600,width=800");
  printWindow.document.write(receiptContent);

  // Print the receipt
  printWindow.print();
  printWindow.close();
  //////////////////////////////////////////////////
  //////////////////////////////////////////////////
  // Generate a random 4-digit order ID
  const randomOrderID = Math.floor(1000 + Math.random() * 9000).toString();

  // Prepare payload for server with the generated order ID
  const payload = {
    tableNumber: tableNumber,
    finalOrder: tables[activeTable].order,
    waiter: tables[activeTable].waiter,
    orderID: randomOrderID, // Add the generated order ID to the payload
  };

  // Send payload to server
  fetch("/submit-final-order", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  })
    .then((response) => {
      if (response.ok) {
        console.log("Final order sent successfully");
        // Additional success handling code here
      } else {
        console.error("Error sending final order");
        // Additional error handling code here
      }
    })
    .catch((error) => {
      console.error("Error:", error);
      // Additional exception handling code here
    });
  //////////////////////////////////////////////////
  //////////////////////////////////////////////////

  // Move the items from the order array to the finalorder array of the selected table
  const itemsToMove = tables[activeTable].order.splice(0);
  tables[activeTable].finalorder.push(...itemsToMove);

  // Remove all child elements from the bill container
  while (billContainer.firstChild) {
    billContainer.removeChild(billContainer.firstChild);
  }
  // Save the data to local storage
  localStorage.setItem("tables", JSON.stringify(tables));

  console.log(tables[selectedTable]);

  closeModal();
}

function printReceipt() {
  const activeTable = selectedTable;
  const itemsToMove = tables[activeTable].order.splice(0);
  tables[activeTable].finalorder.push(...itemsToMove);
  const tableNumber = activeTable.replace("table", "");
  let receiptContent = "<h1>Babe da dhaba - Table " + tableNumber + "</h1>";

  receiptContent += "<ul>";

  // Loop through the items in the bill container and add them to the receipt content

  for (let i = 0; i < tables[selectedTable].finalorder.length; i++) {
    if (tables[selectedTable].finalorder[i].count) {
      receiptContent +=
        "<li>" +
        tables[selectedTable].finalorder[i].count +
        " " +
        tables[selectedTable].finalorder[i].name +
        " - $" +
        tables[selectedTable].finalorder[i].price +
        "</li>";
    } else {
      receiptContent +=
        "<li>" +
        tables[selectedTable].finalorder[i].name +
        " - $" +
        tables[selectedTable].finalorder[i].price +
        "</li>";
    }
  }

  receiptContent += "</ul>";

  // Add the total amount to the receipt content
  receiptContent += "<h2>Total: $" + tables[selectedTable].total + "</h2>";

  // Open a new window and write the receipt content to it
  let printWindow = window.open("", "Print", "height=600,width=800");
  printWindow.document.write(receiptContent);

  // Print the receipt
  printWindow.print();
  printWindow.close();
}

document.getElementById("pay").addEventListener("click", function () {
  if (selectedTable) {
    printReceipt();
    clearbill();
  } else {
    alert("Please select a table to generate the bill.");
  }
});

var myModal = new bootstrap.Modal(
  document.getElementById("exampleModalCenter")
);
document.getElementById("openModal").addEventListener("click", function () {
  myModal.show();
});

function printTotalSale() {
  let sum = 0;
  let count = 1;
  let output = "<h1> BABE DA DHABA SALE </h1>";
  for (const total of allTotals) {
    output += `bill  ${count}:  ` + total + "<br>";
    sum += total;
    count++;
  }
  output += "Total sale for the day: " + sum;
  let printWindow = window.open("", "", "height=500,width=500");
  printWindow.document.write("<html><head><title>Total Sale</title>");
  printWindow.document.write("</head><body >");
  printWindow.document.write(output);
  printWindow.document.write("</body></html>");
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}
